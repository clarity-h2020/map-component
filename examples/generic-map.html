<html>

<body>
    <iframe name="map-component" id="map-component" src="https://csis.myclimateservice.eu/apps/map-component/build/"
        style="width:100%;height:500px;border:1px solid">
    </iframe>

    <script>
        const mapType = 'GenericMap';
        const grouping_tag = 'taxonomy_term--eu_gl';
        const iFrameMapComponent = document.getElementById('map-component');

        try {

            let host = window.location.host, study_uuid, study_area, emikat_id, datapackage_uuid, write_permissions, resource_uuid, minx, miny, maxx, maxy;

            // this is just unbelievable: if drupalSettings is not defined, this throws 'Uncaught ReferenceError: drupalSettings is not defined' in Chrome! WTF!!!!!!
            if (undefined !== drupalSettings && undefined !== drupalSettings.csisHelpers) {
                if (undefined !== drupalSettings.csisHelpers.resourceInfo) {
                    console.info(`showing ${mapType} for resource ${drupalSettings.csisHelpers.resourceInfo.name}`);
                    resource_uuid = drupalSettings.csisHelpers.resourceInfo.uuid;
                    minx = drupalSettings.csisHelpers.resourceInfo.minx;
                    miny = drupalSettings.csisHelpers.resourceInfo.miny;
                    maxx = drupalSettings.csisHelpers.resourceInfo.maxx;
                    maxy = drupalSettings.csisHelpers.resourceInfo.maxy;
                    write_permissions = drupalSettings.csisHelpers.resourceInfo.write_permissions;
                }
                else if (undefined !== drupalSettings.csisHelpers.datapackageInfo) {
                    console.info(`showing ${mapType} for datapackage ${drupalSettings.csisHelpers.datapackageInfo.name}`);
                    datapackage_uuid = drupalSettings.csisHelpers.datapackageInfo.uuid;
                    minx = drupalSettings.csisHelpers.datapackageInfo.minx;
                    miny = drupalSettings.csisHelpers.datapackageInfo.miny;
                    maxx = drupalSettings.csisHelpers.datapackageInfo.maxx;
                    maxy = drupalSettings.csisHelpers.datapackageInfo.maxy;
                    write_permissions = drupalSettings.csisHelpers.datapackageInfo.write_permissions;
                } else if (undefined !== drupalSettings.csisHelpers.studyInfo) {
                    console.info(`showing ${mapType} for study ${drupalSettings.csisHelpers.studyInfo.name}`);
                    study_uuid = drupalSettings.csisHelpers.studyInfo.uuid;
                    study_area = drupalSettings.csisHelpers.studyInfo.study_area;
                    emikat_id = drupalSettings.csisHelpers.studyInfo.study_emikat_id;
                    datapackage_uuid = drupalSettings.csisHelpers.studyInfo.study_datapackage_uuid;
                    write_permissions = drupalSettings.csisHelpers.studyInfo.write_permissions;
                } else if (undefined !== drupalSettings.csisHelpers.entityinfo) {
                    console.warn(`showing ${mapType} for study ${drupalSettings.csisHelpers.entityinfo.study_uuid} for deprecated $entityinfo`);

                    study_uuid = drupalSettings.csisHelpers.entityinfo.study_uuid;
                    study_area = drupalSettings.csisHelpers.entityinfo.study_area;
                    emikat_id = drupalSettings.csisHelpers.entityinfo.study_emikat_id;
                    datapackage_uuid = drupalSettings.csisHelpers.entityinfo.study_datapackage_uuid;
                    write_permissions = drupalSettings.csisHelpers.entityinfo.write_permissions;
                } else {
                    console.error('no entityinfo objects found, map component embedded for unsupported entity type!')
                }

                /**
                 * @type {String}
                 */
                let mapComponentUrl = `https://csis.myclimateservice.eu/apps/map-component/build/${mapType}/?host=${host}`;

                study_uuid ? mapComponentUrl.append(`&study_uuid=${study_uuid}`) : noop;
                study_area ? mapComponentUrl.append(`&study_area=${study_area}`) : noop;
                emikat_id ? mapComponentUrl.append(`&emikat_id=${emikat_id}`) : noop;
                datapackage_uuid ? mapComponentUrl.append(`datapackage_uuid=${datapackage_uuid}`) : noop;
                write_permissions ? mapComponentUrl.append(`&write_permissions=${write_permissions}`) : noop;
                resource_uuid ? mapComponentUrl.append(`&resource_uuid=${resource_uuid}`) : noop;
                minx ? mapComponentUrl.append(`&minx=${minx}`) : noop;
                miny ? mapComponentUrl.append(`&miny=${miny}`) : noop;
                maxx ? mapComponentUrl.append(`&maxx=${maxx}`) : noop;
                maxy ? mapComponentUrl.append(`&maxy=${maxy}`) : noop;

                console.debug(`initilizing iFrame with ${mapComponentUrl}`);
                iFrameMapComponent.setAttribute('src', mapComponentUrl);
            } else {
                console.error('no global csisHelpers object found, probably not connected to Drupal!')
            }
        }
        catch (stupidError) {
            console.error('no global drupalSettings object found, probably not connected to Drupal!');
        }
    </script>
</body>

</html>